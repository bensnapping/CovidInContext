[{"name":"app.R","content":"library(shiny)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(zoo)\n\ngen_data_21 <-\n  read_csv(\"/home/ben/Projects/data-viz/PROJ/setup/converted/mort2021us.csv\")\ngen_data_20 <-\n  read_csv(\"/home/ben/Projects/data-viz/PROJ/setup/converted/mort2020us.csv\")\ngen_data_19 <-\n  read_csv(\"/home/ben/Projects/data-viz/PROJ/setup/converted/mort2019us.csv\")\n\ngen_data <-\n  rbind(gen_data_21, gen_data_20, gen_data_19)\ngen_data$date <-\n  paste(gen_data$data_year, \"-\", gen_data$month, \"-\", \"01\")\n\ngen_data$date <- as.Date(gen_data$date, \"%Y - %m - %d\")\n\ngen_data <- gen_data %>% \n  filter(age_yr != 999)\n\nconditions <- unique(gen_data$ICD10)\n\nui <- fluidPage(\n  titlePanel(\"Covid in Context: USA\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      \n      # time\n      sliderInput(inputId = \"time\",\n                  label = \"time range:\",\n                  min = as.Date(min(gen_data$date), \"%Y-%m-%d\"),\n                  max = as.Date(max(gen_data$date), \"%Y-%m-%d\"),\n                  value = c(as.Date(min(gen_data$date), \"%Y-%m-%d\"), as.Date(max(gen_data$date), \"%Y-%m-%d\"))),\n      \n      # age\n      sliderInput(inputId = \"age\",\n                  label = \"age range:\",\n                  min = 0,\n                  max = 121,\n                  value = c(0, 121)),\n      \n      # ICD10 codes\n      selectizeInput(inputId = \"icd\",\n                     label = \"Conditions:\",\n                     choices = conditions,\n                     multiple = TRUE),\n      \n      # occupation\n      selectizeInput(inputId = \"job\",\n                         label = \"occupations:\",\n                         choices = list(\n                           \"All\" = 00,\n                           \"Management\" = 01,\n                           \"Business and Financial Operations\" = 02,\n                           \"Computer and Mathematics\" = 03,\n                           \"Architecture and Engineering\" = 04,\n                           \"Life, Physical, and Social Sciences\" = 05,\n                           \"Community and Social Servicecs\" = 06,\n                           \"Legal\" = 07,\n                           \"Education, Training, and Library\" = 08,\n                           \"Arts, Design, Entertainment, Sports, and Media\" = 09,\n                           \"Healthcare Practitioners and Technical\" = 10,\n                           \"Healthcare Support\" = 11,\n                           \"Protective Services\" = 12,\n                           \"Food Preparation and Serving\" = 13,\n                           \"Building, Grounds Cleaning, and Maintenance\" = 14,\n                           \"Personal Care and Service\" = 15,\n                           \"Sales and Related\" = 16,\n                           \"Office and Administrative Support\" = 17,\n                           \"Farming, Fishing, and Forestry\" = 18,\n                           \"Construction and Extraction\" = 19,\n                           \"Installation, Maintenance, and Repair\" = 20,\n                           \"Production\" = 21,\n                           \"Transportation and Material Moving\" = 22,\n                           \"Military\" = 24,\n                           \"Housewife\" = 26,\n                           \"Misc.\" = 25),\n                         selected = 00,\n                        multiple = TRUE)\n      \n    ),\n  \n    mainPanel(\n      plotOutput(outputId = \"testPlot\")\n    )\n  )\n)\n\n\nserver <- function(input, output){\n  output$testPlot <-renderPlot({\n    gen_data %>% \n      filter( between(as.Date(date, \"%Y-%m-%d\"), input$time[[1]], input$time[[2]]) ) %>% \n      filter( between(age_yr, input$age[[1]], input$age[[2]]) ) %>% \n      filter( as.numeric(occupation) %in% input$job | as.numeric(occupation) > min(input$job) ) %>% \n      ggplot(aes(x = as.Date(date, \"%Y-%m-%d\"), fill=factor(age_recode_12))) +\n      geom_histogram(binwidth = 30)\n  })\n}\n\nshinyApp(ui = ui, server = server)","type":"text"}]
